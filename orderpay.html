<!DOCTYPE html>
<html lang="en" x-data="{ orders: [],show: false }" x-init="orders = JSON.parse(localStorage.getItem('orders')) || []">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Orders Price</title>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <link href="./src/output.css" rel="stylesheet" />
</head>
<body 
  x-data="{
    orders: [],
    show: false,
    msg: '',
    payment: 0,
    change: null,
    init() {
      const saved = JSON.parse(localStorage.getItem('orders')) || [];
      this.orders = saved.map(item => ({
        ...item,
        quantity: item.quantity || 1
      }));
    },
    updateStorage() {
      localStorage.setItem('orders', JSON.stringify(this.orders));
    },
    get grandTotal() {
      return this.orders.reduce((sum, item) => {
          const basePrice = item.Rprice ? item.Rprice * item.quantity : 0;
          const addonPrice = item.Radd ? item.Radd * item.quantity : 0;
          return sum + basePrice + addonPrice;
      }, 0);
    }
  }"
  x-init="init()"
  class="min-h-screen bg-no-repeat bg-cover bg-center flex flex-col items-center justify-center bg-pink-200 overflow-hidden"
  style="background-image: url('img/settings_sales_ordererzxs.png');"
>

  <!-- Header -->
  <header class="w-full flex items-center full max-w-2xl mb-3 mt-3  gap-3">
    <a href="index.html"><img src="img/swirls-logo.webp" alt="logo" class="w-16"></a>
    <h1 class="text-3xl font-bold">Swirls</h1>
  </header>

  <!-- Orders Box -->
  <div class="p-6 outline-2 rounded-2xl shadow-2xl space-y-4 text-center w-full max-w-2xl">
    <h1 class="text-2xl font-bold"></h1>
    
    <!-- Orders List -->
    <div class="max-h-[50vh] overflow-y-auto w-full px-2">
      <template x-if="orders.length === 0">
        <p class="text-gray-500">No orders yet.</p>
      </template>
      
      <template x-for="(item, index) in orders" :key="index">
        <div class="flex items-center justify-between bg-white px-5 mb-2 py-4 rounded-xl shadow-md">
          <!-- Display Item Info -->
          <div class="text-left text-gray-800 text-base leading-tight "
            x-html="
              // Big Cone
              item.cone 
              ? `<strong>Big Cone</strong> - ${item.flavorBigCone}<br><span>${item.cone}</span>`

              // Sundae Cone
              : item.flavorCone 
                ? `<strong>Sundae Cone</strong> - ${item.flavorCone}<br><span>${item.price}</span>`

              // Sundae Cup
              : item.flavorCup 
                ? `<strong>Sundae Cup</strong> - ${item.flavorCup}<br><span>${item.price}</span>`

              // Daydream Classic
              : item.flavor 
                ? `<strong>Daydream Classic</strong> - ${item.flavor}<br><span>${item.size}</span><br> ${item.price}`

              // Daydream Premium
              : item.flavorddp
                ? `<strong>Daydream Premium</strong> - ${item.flavorddp}<br><span>${item.size}</span> <br> ${item.price}`

              // Vanilla Cone 
              : item.flavorval
                ? `<strong>Vanilla Cone</strong> - ${item.flavorval}<br><span>${item.price}</span> ${item.addon ? `<br><em>Addon: ${item.addon}</em>` : ''}`

              // Swirls Delight
              : item.flavordel
                ? `<strong>Swirls Delight</strong> - ${item.flavordel}<br><span>${item.price}</span>`

              // Soda Float
              : item.flavorflt
                ? `<strong>Soda Float</strong> - ${item.flavorflt}<br><span>${item.price}</span>`

              // Carfait
              : item.flavorcft
                ? `<strong>Carfait</strong> - ${item.flavorcft}<br><span>${item.price}</span>`

              // Milkshake
              : item.flavormlk
                ? `<strong>Milkshake</strong> - ${item.flavormlk}<br>${item.size}<br><span>${item.price}</span>`

              // Iced Coffee Float
              : item.flavoricf
                ? `<strong>Iced Coffee Float</strong> - ${item.flavoricf}<br><span>${item.price}</span>`

              // Unknown Item
              : `<strong>Unknown Item</strong>`
              ">

              
          </div>

            <!-- price & quantity -->
                
    <div class="flex flex-col items-center">
      <span class="text-gray-700 font-medium">
        <span x-text="item.quantity"> </span> pcs
      </span>
      <span class="text-sm font-semibold text-gray-700">
        Php<span 
          x-text="(item.Rprice * item.quantity) + ((item.Radd || 0) * item.quantity)">
        </span>
      </span>
    </div>
          
        </div>
      </template>
    </div>

    <!-- Total Price -->
      <div class="flex justify-end mt-4 pr-4 text-lg font-semibol">
        Total: ₱<span x-text="grandTotal"></span>
      </div>
  </div>
  <!-- Navigation Buttons -->
    <div class="flex justify-between w-full mt-4 space-y-4 text-center max-w-2xl px-2">

        <!-- Back Button -->
        <a href="orderprice.html">
          <div class="w-10 h-10 bg-white flex items-center border-2 justify-center rounded-full shadow-md hover:bg-green-200 cursor-pointer transition">
            <h1 class="text-xl font-bold">&lt;</h1>
          </div>
        </a>

        
        <!-- Pay Button -->
        <div class="  bg-white rounded-xl px-4 py-1 mb-2 text-sm cursor-pointer">
            <div class="  "
                 @click="
                  msg = `Your total is ₱${grandTotal}`;
                  show = true;
          "> 
              Php <span x-text="grandTotal"></span><br> <span class="text-sm">Total Amount</span> 
            </div>
        </div>

      <!-- Next Button -->
      <button type="button">
        <div
          class="w-10 h-10 bg-white flex items-center 
                border-2 justify-center rounded-full shadow-md
                hover:bg-green-200 cursor-pointer transition"
          @click="
            msg = `Your total is ₱${grandTotal}`;
            show = true;
          "
        >
          <h1 class="text-xl font-bold">&gt;</h1>
        </div>


      </button>
      

      <!-- POPUP -->
      <div 
        x-show="show"
        x-transition
        class="fixed inset-0 flex items-center justify-center bg-black/40 z-50"
        style="display: none;"
      >
        <div class="bg-white px-6 py-4 flex flex-col rounded-xl shadow-lg text-center text-sm font-medium space-y-4 w-80">

          <div class="flex justify-between border-b p-0">
            
            <!-- Grand Total Message -->
            <h1 class="text-lg" x-text=" `Total Amount: ₱${grandTotal}`"></h1>

            <!-- Close Button -->
            <button 
              class="self-end text-lg text-center text-red-500 font-extrabold"
              @click="show = false; payment = 0; change = null;"
            >X</button>

 
          </div>

          <!-- Message -->
          <span class="text-lg font-bold" x-text="msg"></span>

          <!-- Payment Input -->
          <div class="flex flex-col gap-2">
            <label for="payment">Enter Payment:</label>
            <input 
              class="border rounded px-2 py-1 text-lg font-semibold text-center" 
              type="number" 
              x-model.number="payment"
              placeholder="₱0"
            >


          </div>

          <!-- Buttons Container -->
          <div class="flex gap-2 justify-between mt-2">

            <!-- Pay Button -->
            <button
              class="bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-600 transition"
              @click="
                if(payment >= grandTotal){
                  change = payment - grandTotal;
                  msg = `Payment Successful! Change: ₱${change}`;
                } else {
                  msg = 'Payment is not enough!';
                  change = null;
                }
              "
            >
              Pay
            </button>

            <!-- Proceed Button (only shows after successful payment) -->
            <button
              x-show="change !== null"
              class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 transition"
              @click="
                window.location.href='sumakses.html';
              "
            >
              Proceed
            </button>

          </div>

        </div>
      </div>




      
            

    </div>
</body>
</html>
